<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Fileserver.Broker">
<Super>%CSP.REST</Super>
<TimeCreated>63879,86166</TimeCreated>

<Parameter name="CHARSET">
<Default>UTF-8</Default>
</Parameter>

<Parameter name="CONTENTTYPE">
<Expression>..#CONTENTTYPEJSON</Expression>
</Parameter>

<Parameter name="CONVERTINPUTSTREAM">
<Expression>$$$YES</Expression>
</Parameter>

<XData name="UrlMap">
<XMLNamespace>http://www.intersystems.com/urlmap</XMLNamespace>
<Data><![CDATA[
<Routes>
<Route Url="/getfilelist" Method="GET" Call="Fileserver.JSON:FileListToJSON"/> 
<Route Url="/requestfile/:fileid" Method="GET" Call="Fileserver.JSON:RequestFile"/>
<Route Url="/download/:downloadid" Method="GET" Call="Fileserver.JSON:DownloadFile"/>
<Route Url="/upload" Method="POST" Call="Fileserver.JSON:UploadFile"/>

<Route Url="/bootstrap.min.css" Method="GET" Call="GetCSS"/>
<Route Url="/angular.min.js" Method="GET" Call="GetJS"/>
<Route Url="/" Method="GET" Call="GetHTML"/>
 </Routes>
]]></Data>
</XData>

<Method name="GetCSS">
<Description>
Method returns user application CSS.</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define CompileTime ##Expression("""" _ $zd($h, 11) _ ", "_ $zdt($NOW(0), 2,1) _ " GMT""")
    set %response.CharSet = "utf-8"
    set %response.ContentType = "text/css"
    do %response.SetHeader("Last-Modified", $$$CompileTime)
   
    if %request.GetCgiEnv("HTTP_IF_MODIFIED_SINCE")=$$$CompileTime {
	    do ..Http304()
    } else {
	    do ##class(Static).Write("CSS")
    }
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="GetJS">
<Description>
Method returns user application JavaScript.</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define CompileTime ##Expression("""" _ $zd($h, 11) _ ", "_ $zdt($NOW(0), 2,1) _ " GMT""")
    set %response.CharSet = "utf-8"
    set %response.ContentType = "text/javascript"
    do %response.SetHeader("Last-Modified", $$$CompileTime)
    
    if %request.GetCgiEnv("HTTP_IF_MODIFIED_SINCE")=$$$CompileTime {
	    do ..Http304()
    } else {
	    do ##class(Static).Write("JS")
    }
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="GetHTML">
<Description>
Method returns user application HTML.</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	#define CompileTime ##Expression("""" _ $zd($h, 11) _ ", "_ $zdt($NOW(0), 2,1) _ " GMT""")
	do %response.SetHeader("Last-Modified", $$$CompileTime)
    set %response.ContentType="text/html"
    if %request.GetCgiEnv("HTTP_IF_MODIFIED_SINCE")=$$$CompileTime {
	    do ..Http304()
    } else {
	    do ##class(Static).Write("HTML")
    }
    
    quit $$$OK
]]></Implementation>
</Method>

<Method name="Http304">
<Description>
Issue an "304 Not Modified" status</Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    set %response.Status="304 Not Modified"
    quit $$$OK
]]></Implementation>
</Method>
</Class>
</Export>
